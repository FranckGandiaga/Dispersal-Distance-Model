# Insect dispersal distance model

We developed this method to characterise patterns of dispersal in outbreaking forest insect pests using time series of moth capture data and phenology, using the spruce budworm as a motivating example. Our method combines time series of moth collection within a single season with a spatial phenological model that classifies individuals as either residents or potential migrants. 
The version presented here was built for our specific project. A more generalized version is currently being developed.

For more information you can access our publication: 
Gandiaga, F. and James, P. M. A., 2023. Quantifying long-distance dispersal of an outbreaking insect species using trap capture data and phenology. Forest Ecology and Management, In Press

## Software

Phenological predictions were done using the **BioSIM** software (Régnière and St-Amant, Régnière et al. 2012) available here: https://cfs.nrcan.gc.ca/projects/133.

This method was developed using **R version 4.3.0** (R Core Team 2020) and relies on a list of packages:
- data.table
- fdrtool
- fieldRS
- ggplot2
- grainscape
- igraph
- knitr
- plyr
- raster
- rgeos
- stringr
- survival
- tidyverse

## R code explications

The code was developed on one script divided in 10 modules. You can navigate to each module by using the search function (ctrl+F). Data is saved separately after each module.
If it’s the first time you use this method, make sure that all modules are run in order. Before using each module, make sure that the previous module has run at least once with your data of interest as each module depends on data generated by the one before it.

IMPORTANT: ALL MAPS SHOULD USE THE SAME COORDINATES SYSTEM

## Modules description:

### BioSIM necessary step before Module 1: 
- Create adult moths’ presence files using Biosim full output across the area of interest.
- First, we generated a map covering from Ontario to Nova Scotia with a 10*10km grid saved as an excel file. The map was used as base to run BioSIM
- Due to Excel number of rows limitations, BioSim simulations must be run on a limited amount of raster cells. 
- In this study simulations are run from May 1st to October 31st from 2012 to 2014 and per increment of 5000 cells at a time.
- Due to Excel number of rows limitations, BioSim simulations must be run on a limited amount of raster cells. 
- In this study simulations are run from May 1st to October 31st from 2012 to 2014 and per increment of 5000 cells at a time.
- BioSIM simulation outputs were saved as csv in segments in the "biosimpath" folder.
- Naming convention:
  - For outputs using the Spruce phenological model finish files with "Spruce.csv"
  - For outputs using the Fir phenological model finish files with "Fir.csv"
	
### Module 1: 
This module compiles the data generated by BioSIM and turns it into one usable file.

### Module 2: 
This module applies a confidence interval of your choice to your BioSIM data.

### Module 3:
Loads BioSIM data with the confidence interval generated in Module 2 as well as additional information on the field sites where adult moths were collected.

### Module 4:
This module is used to load additional maps to geographically restrict the area where dispersal is considered. For example, in our study we looked at host species distribution as well as area of known defoliation during the Quebec outbreak.

### Module 5:
This module uses all the data prepared and fed into it to automatically measure shortest distances between potential phenological origins and actual samples. It automatically sorts through migrants and local individuals based on the phenological data provided by BioSIM and informs the user in real time.

### Module 6:
This module compiles all data generated in Module 5 and combines outputs form the Fir and Spruce models into one.

### Module 7:
This module prepares the data by compiling same either by years or by category of events (migrants 1 and 3 or locals).

### Module 8:
This module prepares the data in the format needed to run the dispersal kernel analysis in Module 9.

### Module 9:
This module was expanded from the code developed by Hirsch et al. 2012. It fits dispersal kernels distributions using Ordinary Least Squares regression (Hirsch et al. 2012; Appendix S1). It saves the data output of the analysis and creates the graphical representation of the analysis for a visual interpretation.

### Module 10:
This is the map generator module. It creates maps that are a visual representation of what the method does. It measures and shows dispersal distances traveled from potential origins to a sample on the day of its collection. The output is both a map and a table. By changing the different arguments this module can also create a map of the location of potential presence of adult moths based on their phenology.


## References

- Hirsch, B. T., M. D. Visser, R. Kays, and P. A. Jansen. 2012. Quantifying seed dispersal kernels from truncated seed-tracking data. Methods in Ecology and Evolution 3:595-602.
- R Core Team (2020. R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
- Régnière, J., and R. St-Amant. 2007. Stochastic simulation of daily air temperature and precipitation from monthly normals in North America north of Mexico. International Journal of Biometeorology 51:415-430.
- Régnière, J., R. St-Amant, and P. Duval. 2012. Predicting insect distributions under climate change from physiological responses: spruce budworm as an example. Biological Invasions 14:1571-1586.


